---
- name: Test run job templates with lock
  hosts: all
  execution_strategy: parallel
  sources:
    - ansible.eda.generic:
        payload:
           - name: DataCenter1
             error: 678
             sleep: 20
           - name: DataCenter2
             error: 303
             sleep: 15
           - name: DataCenter3
             error: 353
             sleep: 10
        loop_count: 3   
        shutdown_after: 90
        create_index: index
  rules:
    - name: "Run job template"
      condition: event.error >= 303
      action:
        run_job_template:
          name: "{{ job_template_name }}" 
          organization: "{{ organization | default('Default') }}"
          job_args:
            extra_vars:
              hello: Fred
              sleep_interval: "{{ event.sleep }}"
          lock: "{{ event.name }}"
